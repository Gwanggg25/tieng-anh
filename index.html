<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mini Game Tá»« Vá»±ng</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;
  font-family:Arial,sans-serif;
  background:#121212;color:#fff;
  display:flex;justify-content:center;align-items:center
}
.hidden{display:none}
.box{
  width:100%;max-width:420px;
  background:#1e1e1e;
  padding:20px;border-radius:16px
}
button,input{
  width:100%;padding:12px;margin:6px 0;
  border:none;border-radius:12px;font-size:16px
}
button{cursor:pointer}
.green{background:#4caf50;color:#fff}
.blue{background:#2196f3;color:#fff}
.orange{background:#ff9800}
.gray{background:#555;color:#fff}

#letters span{
  display:inline-block;padding:14px;margin:6px;
  background:#333;border-radius:12px;
  font-weight:bold;font-size:18px;cursor:pointer
}
#letters span.used{opacity:.3}

.progress{height:8px;background:#333;border-radius:6px;overflow:hidden;margin:10px 0}
.progress div{height:100%;width:0%;background:#4caf50}
#correctText{color:#ffeb3b;font-weight:bold;margin-top:6px}
</style>
</head>

<body>

<audio id="tapSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="wrongSound" src="https://assets.mixkit.co/active_storage/sfx/950/950-preview.mp3"></audio>

<div id="login" class="box">
  <h2>ğŸ‘¤ Nháº­p tÃªn</h2>
  <input id="playerName" placeholder="TÃªn cá»§a báº¡n">
  <button class="green" onclick="saveName()">VÃ o game</button>
</div>

<div id="home" class="box hidden">
  <h2>ğŸ® Mini Game</h2>
  <p>ğŸ‘¤ <b id="showName"></b></p>
  <button class="green" onclick="startShuffle()">Xáº¿p chá»¯</button>
  <button class="green" onclick="startConnect()">Ná»‘i tá»«</button>
  <button class="orange" onclick="showRank()">ğŸ† Báº£ng xáº¿p háº¡ng</button>
</div>

<div id="game" class="box hidden">
  <h3 id="title"></h3>
  <div class="progress"><div id="bar"></div></div>
  <p>â­ <span id="score">0</span> | ğŸ”¥ Combo: <span id="combo">0</span></p>
  <div id="letters"></div>
  <p>ÄÃ¡p Ã¡n: <b id="answer"></b></p>
  <p id="correctText"></p>
  <button class="blue" onclick="check()">Kiá»ƒm tra</button>
  <button class="gray" onclick="removeLast()">XoÃ¡</button>
  <button class="gray" onclick="backHome()">Quay láº¡i</button>
</div>

<div id="rank" class="box hidden">
  <h3>ğŸ† Báº£ng xáº¿p háº¡ng (Offline)</h3>
  <ol id="rankList"></ol>
  <button class="gray" onclick="backHome()">Quay láº¡i</button>
</div>

<script>
const shuffleWords=[
"TOURISM","TEMPERATURE","ESCAPE","LITTER","PROTEST","REQUIRE","SOLUTION",
"WILDFIRE","CHALLENGE","REMOVE","FRIGHTENED","HERITAGE","PERFORM","SCENERY",
"COMPETITION","APPRECIATE","ADVICE","NARROW","CITADEL","HARSH"
];
const connectWords=[
"GLOBAL WARMING","SEA LEVEL","CLIMATE CHANGE","COMBINE WITH","EFFECT ON",
"FLOATING MARKET","LOCAL AUTHORITY","TOURIST DESTINATION",
"SUSTAINABLE HABITAT","PROUD OF"
];

let used=[],answer="",correct="",score=0,combo=0,done=0;
let player="",playerID="";

const $=id=>document.getElementById(id);

/* LOGIN */
function saveName(){
  player=$("playerName").value||"Player";
  playerID=Math.floor(1000+Math.random()*9000);
  localStorage.player=player;
  localStorage.playerID=playerID;
  showHome();
}
if(localStorage.player){
  player=localStorage.player;
  playerID=localStorage.playerID;
  showHome();
}
function showHome(){
  $("login").classList.add("hidden");
  $("game").classList.add("hidden");
  $("rank").classList.add("hidden");
  $("home").classList.remove("hidden");
  $("showName").innerText=`${player} #${playerID}`;
}

/* GAME */
function startShuffle(){startGame("Xáº¿p chá»¯",shuffleWords)}
function startConnect(){startGame("Ná»‘i tá»«",connectWords)}

function startGame(name,list){
  $("correctText").innerText="";
  const pool=list.filter(w=>!used.includes(w));
  if(pool.length===0) used=[];
  correct=pool[Math.floor(Math.random()*pool.length)];
  used.push(correct);

  answer="";
  $("letters").innerHTML="";
  $("answer").innerText="";
  $("title").innerText=name;

  const parts=name==="Xáº¿p chá»¯"?correct.split(""):correct.split(" ");
  parts.sort(()=>Math.random()-.5).forEach(c=>{
    const s=document.createElement("span");
    s.innerText=c;
    s.onclick=()=>{
      if(s.classList.contains("used"))return;
      tapSound.currentTime=0;tapSound.play();
      s.classList.add("used");
      answer+=(name==="Xáº¿p chá»¯"?c:(answer?" ":"")+c);
      $("answer").innerText=answer;
    };
    $("letters").appendChild(s);
  });

  $("home").classList.add("hidden");
  $("rank").classList.add("hidden");
  $("game").classList.remove("hidden");
}

function check(){
  if(answer.trim()===correct){
    combo++;score+=10*combo;done++;
    correctSound.currentTime=0;correctSound.play();
  }else{
    combo=0;
    wrongSound.currentTime=0;wrongSound.play();
    $("correctText").innerText=`âŒ ÄÃ¡p Ã¡n Ä‘Ãºng: ${correct}`;
  }
  update();
  setTimeout(()=>startGame($("title").innerText,
    $("title").innerText==="Xáº¿p chá»¯"?shuffleWords:connectWords),900);
}

function update(){
  $("score").innerText=score;
  $("combo").innerText=combo;
  $("bar").style.width=Math.floor(done/shuffleWords.length*100)+"%";
}

function removeLast(){
  answer="";$("answer").innerText="";
  [...$("letters").children].forEach(s=>s.classList.remove("used"));
}

/* ===== FIX Báº¢NG Xáº¾P Háº NG ===== */
function saveRank(){
  let data=JSON.parse(localStorage.rank||"[]");

  const found=data.find(d=>d.id===playerID);
  if(found){
    if(score>found.score) found.score=score;
  }else{
    data.push({name:player,id:playerID,score});
  }

  data.sort((a,b)=>b.score-a.score);
  localStorage.rank=JSON.stringify(data.slice(0,48));
}

function showRank(){
  saveRank();
  const list=$("rankList");
  list.innerHTML="";
  JSON.parse(localStorage.rank||"[]").forEach((d,i)=>{
    const li=document.createElement("li");
    li.innerText=`#${i+1} | ${d.name} #${d.id} â€” ${d.score}Ä‘`;
    list.appendChild(li);
  });
  $("home").classList.add("hidden");
  $("rank").classList.remove("hidden");
}

function backHome(){showHome()}
</script>
</body>
</html>
