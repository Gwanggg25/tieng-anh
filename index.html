<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mini Game Tá»« Vá»±ng</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;
  font-family:Arial,sans-serif;
  background:#121212;color:#fff;
  display:flex;justify-content:center;align-items:center
}
.hidden{display:none}
.box{
  width:100%;max-width:420px;
  background:#1e1e1e;
  padding:20px;border-radius:16px
}
button,input{
  width:100%;padding:12px;margin:6px 0;
  border:none;border-radius:12px;font-size:16px
}
button{cursor:pointer}
.green{background:#4caf50;color:#fff}
.blue{background:#2196f3;color:#fff}
.orange{background:#ff9800}
.gray{background:#555;color:#fff}

#letters span{
  display:inline-block;padding:14px;margin:6px;
  background:#333;border-radius:10px;
  font-weight:bold;font-size:18px;cursor:pointer
}
#letters span.used{opacity:.3}

.progress{
  height:8px;background:#333;border-radius:6px;
  overflow:hidden;margin:10px 0
}
.progress div{height:100%;width:0%;background:#4caf50}
#correctText{color:#ffeb3b;font-weight:bold;margin-top:6px}
</style>
</head>

<body>

<!-- AUDIO -->
<audio id="tapSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="correctSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="wrongSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/950/950-preview.mp3"></audio>

<!-- LOGIN -->
<div id="login" class="box">
  <h2>ğŸ‘¤ Nháº­p tÃªn</h2>
  <input id="playerName" placeholder="TÃªn cá»§a báº¡n">
  <button class="green" onclick="saveName()">VÃ o game</button>
</div>

<!-- HOME -->
<div id="home" class="box hidden">
  <h2>ğŸ® Mini Game</h2>
  <p>ğŸ‘¤ <b id="showName"></b></p>
  <button class="green" onclick="showShuffleLevel()">Xáº¿p chá»¯</button>
  <button class="green" onclick="startConnect()">Ná»‘i tá»«</button>
  <button class="orange" onclick="showRank()">ğŸ† Báº£ng xáº¿p háº¡ng</button>
</div>

<!-- CHá»ŒN Má»¨C Äá»˜ Xáº¾P CHá»® -->
<div id="level" class="box hidden">
  <h3>ğŸ§  Chá»n má»©c Ä‘á»™</h3>
  <button class="green" onclick="startShuffle('easy')">Dá»…</button>
  <button class="green" onclick="startShuffle('medium')">Trung bÃ¬nh</button>
  <button class="green" onclick="startShuffle('hard')">KhÃ³</button>
  <button class="gray" onclick="backHome()">Quay láº¡i</button>
</div>

<!-- GAME -->
<div id="game" class="box hidden">
  <h3 id="title"></h3>
  <div class="progress"><div id="bar"></div></div>
  <p>â­ <span id="score">0</span> | ğŸ”¥ Combo: <span id="combo">0</span></p>
  <div id="letters"></div>
  <p>ÄÃ¡p Ã¡n: <b id="answer"></b></p>
  <p id="correctText"></p>
  <button class="blue" onclick="check()">Kiá»ƒm tra</button>
  <button class="gray" onclick="removeLast()">XoÃ¡</button>
  <button class="gray" onclick="backHome()">Quay láº¡i</button>
</div>

<!-- RANK -->
<div id="rank" class="box hidden">
  <h3>ğŸ† Báº£ng xáº¿p háº¡ng</h3>
  <ol id="rankList"></ol>
  <button class="gray" onclick="backHome()">Quay láº¡i</button>
</div>

<script>
/* ===== DATA ===== */
const shuffleEasy=[
"TOURISM","SOLUTION","REMOVE","LITTER","ADVICE",
"CITADEL","SCENERY","PERFORM","HERITAGE","PROTEST"
];
const shuffleMedium=[
"REQUIRE","ESCAPE","HARSH","CHALLENGE","NARROW"
];
const shuffleHard=[
"TEMPERATURE","FRIGHTENED","COMPETITION","APPRECIATE","WILDFIRE"
];

const connectWords=[
"GLOBAL WARMING","SEA LEVEL","CLIMATE CHANGE","COMBINE WITH",
"EFFECT ON","FLOATING MARKET","LOCAL AUTHORITY",
"TOURIST DESTINATION","SUSTAINABLE HABITAT","PROUD OF"
];

let answer="",correct="",score=0,combo=0,done=0;
let player="",playerID="",mode="",currentList=[];
let audioUnlocked=false;

const $=id=>document.getElementById(id);

/* ===== SOUND FIX ===== */
function playSound(id){
  const a=$(id);
  if(!audioUnlocked){
    a.play().then(()=>{audioUnlocked=true;a.pause();a.currentTime=0});
    return;
  }
  a.currentTime=0;
  a.play().catch(()=>{});
}

/* LOGIN */
function saveName(){
  player=$("playerName").value||"Player";
  playerID=Math.floor(1000+Math.random()*9000);
  localStorage.player=player;
  localStorage.playerID=playerID;
  showHome();
}
if(localStorage.player){
  player=localStorage.player;
  playerID=localStorage.playerID;
  showHome();
}
function showHome(){
  hideAll();
  $("home").classList.remove("hidden");
  $("showName").innerText=`${player} #${playerID}`;
}
function hideAll(){
  ["login","home","level","game","rank"].forEach(id=>$ (id).classList.add("hidden"));
}

/* LEVEL */
function showShuffleLevel(){
  hideAll();
  $("level").classList.remove("hidden");
}

/* START */
function startShuffle(lv){
  mode="shuffle";
  if(lv==="easy") currentList=[...shuffleEasy];
  if(lv==="medium") currentList=[...shuffleMedium];
  if(lv==="hard") currentList=[...shuffleHard];
  startGame("Xáº¿p chá»¯");
}

function startConnect(){
  mode="connect";
  currentList=[...connectWords];
  startGame("Ná»‘i tá»«");
}

/* GAME */
function startGame(title){
  $("correctText").innerText="";
  correct=currentList[Math.floor(Math.random()*currentList.length)];
  answer="";
  $("letters").innerHTML="";
  $("answer").innerText="";
  $("title").innerText=title;

  const parts=mode==="shuffle"?correct.split(""):correct.split(" ");
  parts.sort(()=>Math.random()-0.5).forEach(c=>{
    const s=document.createElement("span");
    s.innerText=c;
    s.onclick=()=>{
      if(s.classList.contains("used"))return;
      playSound("tapSound");
      s.classList.add("used");
      answer+=(mode==="shuffle"?c:(answer?" ":"")+c);
      $("answer").innerText=answer;
    };
    $("letters").appendChild(s);
  });

  hideAll();
  $("game").classList.remove("hidden");
}

function check(){
  if(answer.trim()===correct){
    combo++;score+=10*combo;done++;
    playSound("correctSound");
    document.body.style.background="#1b5e20";
  }else{
    combo=0;
    playSound("wrongSound");
    $("correctText").innerText=`âŒ ÄÃ¡p Ã¡n Ä‘Ãºng: ${correct}`;
    document.body.style.background="#7f0000";
  }
  update();
  setTimeout(()=>{
    document.body.style.background="#121212";
    startGame($("title").innerText);
  },900);
}

function update(){
  $("score").innerText=score;
  $("combo").innerText=combo;
  $("bar").style.width=Math.min(100,done*5)+"%";
}

function removeLast(){
  answer="";$("answer").innerText="";
  [...$("letters").children].forEach(s=>s.classList.remove("used"));
}

/* RANK */
function saveRank(){
  const data=JSON.parse(localStorage.rank||"[]");
  data.push({name:player,id:playerID,score});
  data.sort((a,b)=>b.score-a.score);
  localStorage.rank=JSON.stringify(data.slice(0,48));
}
function showRank(){
  saveRank();
  const list=$("rankList");
  list.innerHTML="";
  JSON.parse(localStorage.rank||"[]").forEach((d,i)=>{
    const li=document.createElement("li");
    li.innerText=`#${i+1} | ${d.name} #${d.id} â€” ${d.score}Ä‘`;
    list.appendChild(li);
  });
  hideAll();
  $("rank").classList.remove("hidden");
}
function backHome(){showHome()}
</script>
</body>
</html>
